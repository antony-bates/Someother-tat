blueprint:
  name: Dynamic Car Charging based on Energy Price (Select Chargers)
  description: Controls selected car chargers based on current and upcoming energy rates, and price changes.
  domain: automation
  input:
    energy_price_sensor: # Name of your energy price sensor
    offpeak_threshold:  # Price below which charging is allowed (optional, default: 0.1)
    onpeak_threshold:  # Price above which charging is stopped (optional, default: 0.2)
  trigger:
    - platform: state
      entity_id: "{{ trigger.entity_id }}"
    - platform: template
      sensor: "{{ input.energy_price_sensor }}"
  condition:
    - condition: template
      sensor: "{{ input.energy_price_sensor }}"
      value_template: "{{ float(state_attr('sensor.' + trigger.entity_id, 'price')) < input.offpeak_threshold }}"
    - condition: state
      entity_id: "{{ target.entity_id }}"
      state: "on"
  action:
    - target:
      entity: "{{ target.entity_id }}"
    service: switch.turn_on
    - condition: template
      sensor: "{{ input.energy_price_sensor }}"
      value_template: "{{ float(state_attr('sensor.' + trigger.entity_id, 'price')) >= input.onpeak_threshold }}"
    - target:
      entity: "{{ target.entity_id }}"
    service: switch.turn_off
  target:
    - platform: entity
